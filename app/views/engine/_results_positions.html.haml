#content
  %ul.nav.nav-tabs
    %li
      = link_to 'View performance', results_performance_path, data: {method: :post, remote: true, params: {results: @source}}
    %li.active
      = link_to 'View positions', results_positions_path, data: {method: :post, remote: true, params: {results: @source}}
  %h3 Holdings during each period
  - @source[:positions].each do |period|
    .voffset5
    %p.bold= period[1][:end_date] == '' ? "Current portfolio" : "Period ending #{period[1][:end_date]}"
    %table.table.table-condensed.smaller-font.table-hover
      %tr.table-header.blue-background
        %th{ rowspan: 2 } Capital IQ ID
        %th{ rowspan: 2 } Company
        %th{ rowspan: 2 } Shares
        %th{ colspan: 2 }= "as of #{period[1][:start_date]}"
        %th{ colspan: 2 }= period[1][:end_date] == '' ? '' : "as of #{period[1][:end_date]}"
        %th{ rowspan: 2 }= period[1][:end_date] == '' ? '' : 'Profit'
        %th{ rowspan: 2 } Notes
      %tr.table-header.blue-background
        %th Price per share
        %th Market value
        %th= period[1][:end_date] == '' ? '' : 'Price per share'
        %th= period[1][:end_date] == '' ? '' : 'Market value'
      - period[1][:positions].each do |position|
        %tr.right-aligned
          %td.left-aligned= position[1][:cid]
          %td.left-aligned= position[1][:company_name]
          %td= number_with_delimiter(position[1][:share_count])
          %td= number_to_currency(position[1][:beginning_price])
          %td= number_to_currency(position[1][:beginning_value])
          %td= period[1][:end_date] == '' ? '' : number_to_currency(position[1][:ending_price])
          %td= period[1][:end_date] == '' ? '' : number_to_currency(position[1][:ending_value])
          %td= period[1][:end_date] == '' ? '' : number_to_currency(position[1][:profit], negative_format: "(%u%n)")
          %td= position[1][:notes]
      %tr.right-aligned.italic
        %td.left-aligned Cash
        -3.times do
          %td
        %td= number_to_currency(period[1][:cash])
        %td
        %td= period[1][:end_date] == '' ? '' : number_to_currency(period[1][:cash])
        %td
        %td
      %tr.right-aligned.bold.blue-background
        %td.left-aligned Total
        - 3.times do
          %td
        %td= number_to_currency(period[1][:total_value_beginning])
        %td
        %td= period[1][:end_date] == '' ? '' : number_to_currency(period[1][:total_value_ending])
        %td= period[1][:end_date] == '' ? '' : number_to_currency(period[1][:total_profit], negative_format: "(%u%n)")
        %td